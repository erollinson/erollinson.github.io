---
title: "Plantsgiving"
author: "Emily Rollinson"
date: "November 22, 2018"
output: html_document
---

============
# Libraries
============

The code below checks to see if you already have the package installed. If you have it, it loads it up; if you don't have it, it installs it and then loads it up. 

```{r}

#this chunk of code defines the function that checks for missing packages, installs them, and then loads everything
#no edits needed to this part

autopack <- function(pkg){
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if(length(new.pkg))
    install.packages(new.pkg, dependencies = TRUE)
  sapply(pkg, require, character.only = TRUE)
}

#this chunk actually runs the function we defined above
#if you need more packages, just add them to the list in c() below

packageslist <- c("ape", "ggplot2", "tidyr", "dplyr", "magrittr", "tidyverse")
autopack(packageslist)

```

ggtree needs to be installed from Bioconductor:

```{r}
#uncomment these lines if you need to install ggtree
source("https://bioconductor.org/biocLite.R") ## installs & loads BiocInstaller
biocLite("ggtree") ## installs ggtree from Bioconductor
library("ggtree")
```

==================
# Building the tree
==================

Tree was created with web version of Phylomatic (http://phylodiversity.net/phylomatic/) using the R20120829 megatree. Branch lengths were adjusted with the Bladj function in Phylocom http://phylodiversity.net/phylocom/ using node age estimates from Gastauer and Miera-Neto 2016 Braz J Biol https://www.ncbi.nlm.nih.gov/pubmed/27097100  

*Importing data*

```{r} 
#load flora
species <- read.csv("Plantsgiving/plantsgiving.csv")
tree <- read.tree("Plantsgiving/plantsgiving2adj.new")
```

==============
# Tidying data
==============

Filter original species list to names and family

```{r}
species2 <- species %>%
  select(Plant, Family, phylomatsp)
str(species2)
species2$phylomatsp <- as.character(species2$phylomatsp)
species2$Plant <- as.character(species2$Plant)
```

Replace the tip labels with cleaner text

```{r}
tree2<-tree
tree2$tip.label<- species2$Plant[match(tree2$tip.label, species2$phylomatsp)]
tree2$tip.label<-as.character(tree2$tip.label)
```

===========
# Plotting
===========

```{r}
#circular tree
round<- ggtree(tree2, layout="circular") %<+% species2 + geom_tiplab2(size=3, aes(angle=angle, color=Family)) + theme(legend.position="right")
round

#save image
ggsave(round, file="plantsgiving_color_round_family_adj2.pdf", width=30, height=30)
```